function C=C_e_b(q,x)

  if nargin==1
    %% matrix de rotation repere terrestre vers objet
    C = reshape([ q(1,:).^2+q(2,:).^2-q(3,:).^2-q(4,:).^2; 2*(q(2,:).*q(3,:)-q(1,:).*q(4,:));       2*(q(2,:).*q(4,:)+q(1,:).*q(3,:)) ;
                  2*(q(2,:).*q(3,:)+q(1,:).*q(4,:));       q(1,:).^2-q(2,:).^2+q(3,:).^2-q(4,:).^2; 2*(q(3,:).*q(4,:)-q(1,:).*q(2,:)) ;
                  2*(q(2,:).*q(4,:)-q(1,:).*q(3,:));       2*(q(3,:).*q(4,:)+q(1,:).*q(2,:));       q(1,:).^2-q(2,:).^2-q(3,:).^2+q(4,:).^2],3,3,[]);
  else
    %% derive de la rotation d'un vecteur
    C = reshape(2*[q(1,:).*x(1,:)-q(4,:).*x(2,:)+q(3,:).*x(3,:);  q(2,:).*x(1,:)+q(3,:).*x(2,:)+q(4,:).*x(3,:);  -q(3,:).*x(1,:)+q(2,:).*x(2,:)+q(1,:).*x(3,:);  -q(4,:).*x(1,:)-q(1,:).*x(2,:)+q(2,:).*x(3,:);
                   q(4,:).*x(1,:)+q(1,:).*x(2,:)-q(2,:).*x(3,:);  q(3,:).*x(1,:)-q(2,:).*x(2,:)-q(1,:).*x(3,:);   q(2,:).*x(1,:)+q(3,:).*x(2,:)+q(4,:).*x(3,:);   q(1,:).*x(1,:)-q(4,:).*x(2,:)+q(3,:).*x(3,:);
                  -q(3,:).*x(1,:)+q(2,:).*x(2,:)+q(1,:).*x(3,:);  q(4,:).*x(1,:)+q(1,:).*x(2,:)-q(2,:).*x(3,:);  -q(1,:).*x(1,:)+q(4,:).*x(2,:)-q(3,:).*x(3,:);   q(2,:).*x(1,:)+q(3,:).*x(2,:)+q(4,:).*x(3,:)],3,4,[]);
  end
end
